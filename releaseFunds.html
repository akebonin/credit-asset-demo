<!DOCTYPE html>
<html>
<head>
  <title>releaseFunds</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body style="font-family: sans-serif; padding: 2em; text-align: center;">
  <h2>Release Funds</h2>
  <p id="status">Initializing...</p>

  <script>
    async function main() {
      const params = new URLSearchParams(window.location.search);
      const yieldValue = parseInt(params.get("yield"));
      const CONTRACT_ADDRESS = "0xfb3fc9218cb7c555b144f36390cde4c93aa8cbd6";
      const ABI = [{
        "inputs": [{"internalType": "uint256", "name": "actualYield", "type": "uint256"}],
        "name": "releaseFunds",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }];

      const statusEl = document.getElementById("status");

      if (!window.ethereum) {
        statusEl.textContent = "‚ùå MetaMask not available";
        return;
      }

      try {
        statusEl.textContent = "üîó Connecting to MetaMask...";
        await window.ethereum.request({ method: 'eth_requestAccounts' });

        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();
        const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

        statusEl.textContent = "üöÄ Sending transaction...";
        const tx = await contract.releaseFunds(yieldValue);
        statusEl.textContent = "‚úÖ Transaction sent: " + tx.hash;
      } catch (err) {
        statusEl.textContent = "‚ùå Error: " + err.message;
      }
    }

    window.onload = main;
  </script>
</body>
</html>